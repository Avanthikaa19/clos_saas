<mat-toolbar class="tool-bar">
    <span [routerLink]="'/desicion-engine/home'" style="cursor: pointer;">Decision Engine</span>
    <span class="separator-div">
        <div class="separator"></div>
    </span>
    <span [routerLink]="'/desicion-engine/config/config-nav'" style="cursor: pointer;">
        Data Adminstration
    </span>
    <span class="separator-div">
      <div class="separator"></div>
    </span>
    <span> Object Model Editor</span>
    <span class="spacing"></span>
    <button mat-flat-button class="btn-toolbar" (click)="onBackClick()">
        <mat-icon>keyboard_arrow_left</mat-icon>
        Go Back
    </button>
</mat-toolbar>

<div class="main-container ">
    <div class="search-container ">
        <span class="title">
            Object Model:
        </span>
        <div class="spacer"></div>
        <button mat-button class="first-btn close" *ngIf="fileName" (click)="clearSelection()">
            <mat-icon>close</mat-icon>
            <span>Clear Selection</span>
        </button>
        <span style="padding-right: 10px; width: 15%;" *ngIf="fileName">
            <input class="min-input" placeholder="Edit File Name..." [(ngModel)]="fileName" name="fileName">
        </span>
        <button mat-raised-button style="background-color: black; color: white;" *ngIf="fileName" (click)="uploadFile()" [disabled]="uploading">
            <mat-icon>cloud_upload</mat-icon>{{uploading ? 'Uploading' : 'Upload'}}
        </button>
        <input type="file" class="file-input" accept=".xsd" hidden (change)="onFileSelected($event)" #fileUpload>
        <button mat-stroked-button *ngIf="!fileName && !uploading" (click)="fileUpload.click()">
            <mat-icon>folder</mat-icon>
            <span>Browse File</span>
        </button>
        <button mat-stroked-button *ngIf="!fileName && !uploading" (click)="saveDefaultObjectModel()">
            <mat-icon>save</mat-icon>
            <span>Save</span>
        </button>
        <!-- <button mat-stroked-button style="float:right;"
        (click)="onBackClick()">
        <mat-icon>keyboard_arrow_left</mat-icon>
        Go Back
        </button> -->
    </div>
    <div class="inner-search-container">
        <mat-icon class="icon-search">search</mat-icon>
        <input class="min-input" [(ngModel)]="objectSearchKey" (keyup)="objectTypeSearch();" style="margin: 10px; width: 40%; padding-left: 4rem; height: 3rem;" placeholder="Search Keywords...">
        <mat-icon style="color: red;margin-left: -3.5rem;" (click)="objectSearchKey=''">cancel</mat-icon>
    </div>
    <div class="content-container ">
        <div class="drawer-content-container ">
            <div class="inner-container">
                <!-- <mat-card class="select-card" *ngIf="dataSource.data.length < 1">
                    <mat-icon>info</mat-icon>{{message}}
                </mat-card> -->
                <ng-container *ngIf="dataSource.data.length == 0 && objectSearchKey != ''">
                    <div style="margin-top: 200px;margin-left: 650px;">
                        No Result Found
                    </div>
                </ng-container>
                <ng-container *ngIf="dataSource.data.length>=1">
                    <div class="tree-view-container">
                        <!-- <div class="tree-view-header flex-row-parent">
                            <span class="category-sub-header flex-unstetch"
                                style="color: gray; font-style: normal; font-size: 1.6rem;">
                                {{selectedObjectModel.name}}
                            </span>
                            <span class="flex-stetch">
                                <ng-container *ngIf="objectModelChild.length > 0 && !loading">
                                    <button mat-stroked-button (click)="addNewField()">
                                        <mat-icon>add</mat-icon>
                                        <span>
                                            Add New Field
                                        </span>
                                    </button>
                                </ng-container>
                            </span>
                            <span class="tree-view-menu flex-stetch">
                                <button mat-icon-button [matMenuTriggerFor]="menu"
                                    aria-label="Example icon-button with a menu">
                                    <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item (click)="exportObjectModel()">
                                        <mat-icon>import_export</mat-icon>
                                        <span>Export the Object Model</span>
                                    </button>
                                </mat-menu>
                            </span>
                        </div> -->
                        <div class="tree-view-data">
                            <div class="tree-view">
                                <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
                                    <mat-selection-list #node [multiple]="false">
                                        <mat-nested-tree-node *matTreeNodeDef="let node">
                                            <li>
                                                <div class="mat-tree-node"> <button mat-icon-button>
                                                    <mat-icon inline style="margin-top: 0px;">keyboard_arrow_right</mat-icon>
                                                </button> {{(node.type!=''?(node.name+' - '+node.type):node.name)}}</div>
                                            </li>
                                        </mat-nested-tree-node>
                                    </mat-selection-list>
                                    <mat-nested-tree-node *matTreeNodeDef="let node;when: hasChild" style="cursor: pointer;" (click)=selectedChild(node)>
                                        <li class="example-tree-container">
                                            <div class="mat-tree-node node-container">
                                                <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.filename">
                                                    <mat-icon class="mat-icon-rtl-mirror">
                                                        {{treeControl.isExpanded(node) ? 'indeterminate_check_box' :
                                                        'add_box'}}
                                                    </mat-icon>
                                                </button> {{node.name}}
                                            </div>
                                            <ul class="example-tree-nested-node">
                                                <div *ngIf="treeControl.isExpanded(node)">
                                                    <ng-container matTreeNodeOutlet></ng-container>
                                                </div>
                                            </ul>
                                        </li>
                                    </mat-nested-tree-node>
                                </mat-tree>
                            </div>
                            <div class="table-view">
                                <ng-container *ngIf="objectModelChild.length == 0 && !loading">
                                    <div class="select-card-container">
                                        <span>
                                            Please select from left.
                                        </span>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="loading">
                                    <div style="margin-top: 25%; margin-left: 45%;">
                                        <div class="loading__line">
                                            <div class="load-1">
                                                <div class="line"></div>
                                                <div class="line"></div>
                                                <div class="line"></div>
                                                <p style="display: inline-block;"> Loading...</p>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="objectModelChild.length > 0 && !loading">
                                    <app-object-table [item]="objectModelChild" (parentFun)="getDefaultObjectModelData()" (filterChange)="updateChangedOnChild($event)"></app-object-table>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
</div>
<notifier-container></notifier-container>